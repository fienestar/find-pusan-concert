<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="/assets/css/general.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script src="/assets/js/parse-querystring.js"></script>
</head>
<body style="margin: 0px;">
<div id="map" style="width:100%; height:153.6px; margin:0px; padding:0px;"></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b2a898cb9a024328af6e46937dc2d096&libraries=services"></script>
<script>
if(parsed_query_string.keyword){
    let keyword = decodeURIComponent(parsed_query_string.keyword)
    let infowindow = new kakao.maps.InfoWindow({zIndex:1});

    let mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(37.566826, 126.9786567),
            level: 3
        };

    let map = new kakao.maps.Map(mapContainer, mapOption); 
    let ps = new kakao.maps.services.Places();

    ps.keywordSearch(keyword, placesSearchCB);

    function placesSearchCB (data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {
            let bounds = new kakao.maps.LatLngBounds();
            data = Array.from(data)
            let related = data.filter(v=>v.place_name.startsWith(keyword) && !v.place_name.includes('주차장'))
            let eq = data.filter(v=>v.place_name == keyword)

            if(eq.length){
                let place = eq[0]
                displayMarker(place);    
                map.setCenter(new kakao.maps.LatLng(place.y, place.x));
                return;
            }

            if(!related.length){
                //console.log(keyword + "not found")
                return;
            }
            
            for (let place of related){
                displayMarker(place);    
                bounds.extend(new kakao.maps.LatLng(place.y, place.x));
            }

            map.setBounds(bounds);
        } 
    }

    function displayMarker(place) {
        let marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(place.y, place.x) 
        });
    }
}
</script>
</body>
</html>